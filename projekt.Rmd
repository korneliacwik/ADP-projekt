---
title: "Analiza rynku nieruchomości w 2018 roku"
author: "Kornelia Ćwik, Adam Rubczyński"
date: "11 05 2020"
output: html_document
---

```{r setup, include=FALSE}
library(sf)
library(readxl)
library(spData)
library(ggplot2)
library(dplyr)
library(scales)
knitr::opts_chunk$set(echo = TRUE)
```


## Wstęp
Analiza rynku nieruchomości została przygotowana w oparciu o dane z Banku Danych Lokalnych GUSu. Wykorzystane zostały dane z 2018 roku na temat rynkowej sprzedaży lokali mieszkalnych, stopy bezrobocia rejestrowanego oraz dochodów powiatów w przeliczeniu na 1 mieszkańca. <br>
W raporcie nie posługiwaliśmy się wartością bezwzględną sprzedanych mieszkań, ale wartością przeliczoną na 1000 mieszkańców. W tym celu wykorzystaliśmy dane o ludności z Narodowego Spisu Powszechnego z 2011 roku. Dane GUSu o dochodach w przeliczeniu na 1 mieszkańca również zostały stworzone w oparciu o ten spis.

To jest nauka gita!


## Przygotowanie danych
```{r}
powiaty <- st_read(dsn = 'dane/jednostki_administracyjne/Powiaty.shp')

nieruchomosci <- readxl::read_xlsx('dane/rynek_nieruchomosci.xlsx', sheet = 2)
bezrobocie <- readxl::read_xlsx('dane/bezrobocie_rejestrowane.xlsx', sheet = 2)
dochody <- readxl::read_xlsx('dane/dochody_na_mieszkanca.xlsx', sheet = 2)
spis <- readxl::read_xlsx('dane/spis_powszechny_2011.xlsx', sheet = 2)

colnames(bezrobocie)[1] <- 'JPT_KOD_JE'
colnames(nieruchomosci)[1] <- 'JPT_KOD_JE'
colnames(dochody)[1] <- 'JPT_KOD_JE'
colnames(spis)[1] <- 'JPT_KOD_JE'


powiaty$JPT_KOD_JE <- paste0(powiaty$JPT_KOD_JE, '000')

df <- powiaty %>%
  left_join(bezrobocie, by = c(('JPT_KOD_JE')))

df <- df %>%
  left_join(dochody, by = c(('JPT_KOD_JE')))

df <- df %>%
  left_join(nieruchomosci, by = c(('JPT_KOD_JE')))

df <- df %>%
  left_join(spis, by = c(('JPT_KOD_JE')))

df %>%
  mutate(Lokale_na_1000_mieszk = (Lokale/Ludność)*1000) -> df

df %>%
  mutate(Lokale_pierwotny_procent = Lokale_pierwotny/Lokale*100) -> df
```

## Podział na rynek pierwotny i wtórny
```{r}
ggplot(data = df, aes(fill = Lokale_pierwotny_procent)) +
  geom_sf() +
  labs(title = 'Lokale z rynku pierwotnego wśród wszystkich sprzedanych lokali (%)') 

```

Widać, że duży odsetek mieszkań z rynku pierwotnego występuje w: TU WYMIENIĆ LOKALIZACJE, MOŻE DODAĆ NAZWY MIAST NA MAPIE. <br> <br>

Powiaty, w których mieszkania z rynku pierwotnego stanowią największą część sprzedanych mieszkań:
```{r}
df %>%
  st_set_geometry(NULL) %>%
  arrange(by = desc(Lokale_pierwotny_procent)) %>%
  top_n(10) %>%
  select(JPT_NAZWA_, Lokale_pierwotny_procent, Lokale_pierwotny)
```

## Kartogramy 
```{r}
ggplot(data = df, aes(fill = Stopa_bezrobocia)) +
  geom_sf() +
  labs(title = 'Stopa bezrobocia rejestrowanego') + 
  scale_fill_gradient2(low = 'red', high = 'green')

ggplot(data = df, aes(fill = Dochód_na_mieszkanca)) +
  geom_sf() +
  labs(title = 'Dochód powiatu w przeliczeniu na 1 mieszkańca') + 
  scale_fill_gradient2(low = 'red', high = 'green')


ggplot(data = df, aes(fill = Lokale_na_1000_mieszk)) +
  geom_sf() +
  labs(title = 'Liczba sprzedanych lokali mieszkalnych na 1000 mieszkańców') + 
  scale_fill_gradient2(low = 'red', high = 'green')
```

## Sprzedaż lokali mieszkalnych a dochody powiatu

## Sprzedaż lokali mieszkalnych a stopa bezrobocia




